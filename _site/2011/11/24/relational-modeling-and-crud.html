<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="/images/favicon.ico">
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="/stylesheets/pygment_trac.css">
	<link rel="stylesheet" href="/stylesheets/stylesheet.css">
	

    <title>Relational modeling and CRUD - OrigoDB</title>


    <!-- Custom styles for this template -->
    <link href="starter-template.css" rel="stylesheet">


    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
  
  <a href="https://github.com/devrexlabs"><img style="position: absolute; top: 40px; right: 0; border: 0;" src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>

    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>

                  <a class="brand" href="/" style="float: left; font-size: small">
                    <img style="margin-top: 12px; margin-left:16px; height: 26px; width: 26px" src="/images/origodb.png" /></a>

        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
		<li><a class="brand" href="/">Start</a></li>
		  <li><a href="/intro">Intro</a></li>
			<li><a href="/examples">Examples</a></li>
			<li><a href="/repos">Repositories</a></li>
			<li><a href="/docs">Documentation</a></li>
			<!-- <li><a href="/blog">Blog</a></li> -->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">

      <div class="starter-template">
		<h1 id="relational-modeling-and-crud">Relational modeling and CRUD</h1>
<p>I’m experimenting with support for relational modeling for #liveDB based on generics. Here’s a peek at how this is progressing.</p>

<h2 id="entities">Entities</h2>

<p>Entities of type E  are stored in an EntitySet<e>, which wraps a SortedSet<e>, a new collection class in .NET 4 implemented as a balanced binary tree with O(log N) read and write operations.  Entities need to be orderable within the sorted set, which can be achieved using a key property implementing IComparable or having the entity itself implement IComparable<e>.  Here are some example entities with keys defined in three different ways:</e></e></e></p>

<script src="https://gist.github.com/rofr/769653f48d2c7e26cb5f.js"> </script>

<p>The Category entity has a property named Id of type IComparable<int> which by naming convention will be used as a key. The User entity has a property marked with KeyAttribute. Task implements IComparable<task> so Task objects will themselves be used as key and the Id property will be ignored. Task has a foreign key property, CategoryId,  but notice that none of the entities have any outbound object references. An entity can be an aggregation but must be an isolated from other entities meaning no inbound or outbound object references. For example, an Order entity can have a collection of OrderLine objects.</task></int></p>

<p>This isolation is important for queries. Imagine an N-to-N relationship between Category and Task above, where Category has a  collection of Tasks and Task has a collection of Categories. A query for a single task could possibly return every Task and Category in the database! This is a common beginners mistake. Normally, we deal with this issue by returning specific view objects stripped from references. We could for instance have a TaskView class with the categories represented as a list of string.</p>

<h2 id="the-model">The model</h2>
<p>Next, create a model and derive from RelationalModel,  defining entity sets in the constructor:</p>

<script src="https://gist.github.com/rofr/f634e96864d2ff2be83e.js"> </script>

<p>Not much going on here, really.</p>

<h2 id="crud-commands-and-querying">CRUD commands and querying</h2>
<p>Now start your engine and you’re all set up for basic CRUD using commands of type AddEntityCommand<e>, RemoveEntityCommand<e> and ReplaceEntityCommand<e>. Of course, nothing is stopping you from also creating custom commands.  EntitySet<e> implements IEnumerable<e> so query as usual using lambdas or Query&lt;M,R&gt; instances.</e></e></e></e></e></p>

<p>Here is the AddEntityCommand<e> in action:</e></p>

<script src="https://gist.github.com/rofr/0fde983ec5d167ab4b0e.js"> </script>

<h2 id="conclusion">Conclusion</h2>
<p>Ok, so this isn’t really relational but it does enable basic CRUD, provided you do your modeling correctly. With CRUD you don’t have to write specific task-oriented commands and you can return entities from queries without having to map to reference-stripped view objects.</p>

		
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'devrexlabsgithubio'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
		
		
      </div>
		<div class="well well-sm">
		&copy; Devrex Labs | OrigoDB - In-memory database toolkit for NET/Mono | Build faster systems, faster 
		</div>

    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
  </body>
</html>
	